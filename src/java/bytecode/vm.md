
# 虚拟机



- Jvm虚拟机本质上是一个极其复杂的状态机程序，关于什么是状态机可以参考bilibili Up主 [绿导师原谅你了](https://space.bilibili.com/202224425?spm_id_from=333.999.0.0)，他的操作系统课程可以帮助你更好理解程序是什么。
- 字节码对标的是普通机器上的汇编语言。针对某一个平台编写的程序几乎无法无法在另一个平台上运行(转译层除外)，Java的出现可以保证适配了Java的平台都能够运行近乎所有的Java程序，这也是它强大的跨平台兼容性的由来。

## 虚拟机中的类型

- Java语言中的八大基本数据类型和Java虚拟机中的数据类型
  - Java语言中八大基本数据类型
    - 整型: byte shore int long
    - 浮点型: double float
    - 字符型: char
    - 布尔型: boolean
  - Java虚拟机中的数据类型
    - 引用类型(reference type)
    - 原始类型(primitive type)
- 原始类型被称为值类型，引用类型同引用类型
  
     原始类型包括: byte short int long char float double
<br>
    boolean的值有两种:true和false，零值为false，虽然虚拟机中定义了boolean这种原始类型，但是却没有指令直接支持其操作。
<br>

    所以，对boolean类型在虚拟机中还是使用int类型来表示 1表示true 0表示false。
    returnAddress类型表示一个指向操作码的指针，此操作码与虚拟机指令相对应。
<br>

    从以上可以看出，在Java虚拟机的**原始类型**中，除了returnAddress，其余都和八大基本数据类型一一对应。那么**引用类型**呢？很明显，**引用类型**与Java中对象引用有关，在虚拟机中，对象表示为某个累的实例或者是某个数组，指向次对象就用引用类型来表示。reference类型的值，可以当作指向内存中此对象的指针，每个对象可能存在多个指向它的指针，对象的操作、检查、传递都通过引用它的指针来进行。
<br>

    tips :（引用类型其实就是对指针的阉割版本，将指针的引用自动化，这样做能够大大减少开发人员的心智负担，同时也是Java是值传递还是引用传递之争的由来）
    一派认为所有的内容都是传递的值，包括引用时的指针复制和赋值都属于复制。
    一派认为八大基本类型都是值传递，到了引用类型就变为了引用传递。

## 评价

他们认为传递指针也是传递值（为了方便程序员理解做的抽象倒是被理解得越来越抽象），也就是复制指针的值给另一个变量，也就是开辟了一个内存来存放这个引用(指针)，这要是一直扯下去所有语言都能变成值传递。

发现了吗，Java虚拟机里的两类数据类型：[原始类型和引用类型，与之对应的也存在原始值和引用值](#虚拟机中的类型)。

原始类型包括 byte、short、int、long、char、float 、double、boolean。

引用类型包括类类型，接口类型和数组类型。它们的值都是动态创建对象的引用。还有一种特别的引用值为null，它表示该变量没有引用任何对象。

ps：这也是为什么会在方法签名的参数列表上声明final的原因，有些人会将参数列表的值替换为一个新对象，操作做完后也不将对象返回出去，在那里问为什么这个对象没有被修改。
例如：

```java
public static void main(String[] args){
    String foo="foo";
    foo(foo);
    System.out.println(foo)
}
public static void foo(String msg){
    msg="bar"
}
```

给方法加上final就可以避免，当然，还是要有这个概念。

<br>  
    第二派的观点差不多能够解释大部分，但是方法调用的参数列表是单独开的一个内存空间，空间也是变量，里面存放的引用，把空间变量里的引用替换了自然无法影响到原引用数据。

<br>
    可以自己编写一个状态机就明白这些概念了，这些特性真的只是看编译器怎么编译，他们是犯了一种非要界定概念的一种病。隔壁C#和Java一样，但是就没Java吵得那么厉害。
<br>

### Java字节码

java之于字节码就如同汇编指令在PC上的意义。

- Java字节码指令包括
  - 存储指令（例如：aload_0,istore）
  - 算术与逻辑指令（例如：ladd,fcmpl）
  - 类型转换指令（例如：i2b，d2i）
  - 对象创建与操作指令（例如：new,putfield）
  - 堆栈操作指令（例如：swap，dup2）
  - 控制转移指令（例如：ifeq，goto）
  - 方法调用与返回指令（例如：invokespecial，areturn）
